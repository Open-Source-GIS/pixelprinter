<div id="sidebar">
  <div class="sidebar-block " > <!-- order details -->
    <h1>Order <%= @order.name %></h1>
    <p class="customer-name"><%= @order.billing_address.name %> (<%= @order.billing_address.country %>)</p>
    <p class="order-price"><%= money_with_currency(@order.total_price) %> <span class="<%= @order.financial_status %>"><%= @order.financial_status %></span></p>
    <p><%= link_to "Go back to original order", @order.url, :title => "Open order in Shopify admin interface", :class => 'action' %></p>  
  </div>

  <div class="sidebar-block"> <!-- templates -->
    <h2>Templates</h2>   <p class="template-editmode"><%= link_to_function image_tag("button-edit.png"), "Templates.toggleEditMode();" %></p>       
    <% if @tmpls.blank? %>
      <p>No templates found, you should create a new one.</p>
    <% else %>
      <% form_tag({:action => 'print'}, :id => "selected-templates") do %>
      <ul id="list-templates">
        <% @tmpls.each do |tmpl| %>
          <%= render :partial => 'template_checkbox', :locals => {:tmpl => tmpl, :order => @order} %>
        <% end %>
      </ul>
      <% end %>
      <p class="new-template" style="display: none"><%= link_to_remote "Add template", :url => {:controller => 'print_templates', :action => 'new'}, :method => :get %></p>
    <% end %>
  </div>

  <div class="sidebar-block" id="print-button"> <!-- print -->
    <%= link_to_function image_tag("button-print.png"), "Templates.print()", :style => "margin: 10px 0 0px 0" %>
    <p style="font-size: 12px; 	text-align: center;"><%= content_tag :span, "0 documents", :id => "template-amount" %> will be printed.</p>
	</div><!-- last sidebar block -->
	
	<img src="../images/logo.png" width="229" height="176" alt="Logo" class="logo" style="margin-top:-10px" />
</div><!--sidebar-->

<!-- This is populated later via AJAX and popped up with the dialog function of JQueryUI -->
<div id="modal-dialog"></div>

<!-- Empty Containers in correct order, ready to be filled with AJAX previews -->
<div id="preview" class="clearfix">
  <% @tmpls.each do |tmpl| %> <div id="preview-<%= tmpl.id %>"></div> <% end %>
</div>

<% content_for :javascript do %>
Templates.initialize('<%= @order.id %>');

// load default template previews on start
$("#selected-templates :checkbox:checked").each(function() {
  Templates.updateSelection($(this));
});

// live event handlers make sure the events also work for ajax inserted elements later on
$("#selected-templates :checkbox").live("change", function() {
  Templates.updateSelection($(this));
});
<% end %>